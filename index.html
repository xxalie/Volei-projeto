<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Vôlei de Praia OFC1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="Sportsbettingspot-Summer-Olympics-Beach-volley.128.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <nav>
      <ul>
        <li><a href="#torneios">Torneios</a></li>
        <li><a href="#inscricao">Inscrição</a></li>
        <li><a href="#galeria">Galeria</a></li>
        <li><a href="login.html">Login (Organizador)</a></li>
      </ul>
    </nav>

    <header>
      <h1 id="inicio">Vôlei de Praia Amador</h1>
    </header>

    <main>
      <!-- Torneios -->
      <section id="torneios" class="container">
        <h2>Torneios de Vôlei</h2>
        <table>
          <thead>
            <tr>
              <th>Nome do Torneio</th>
              <th>Data</th>
              <th>Local</th>
              <th>Descrição</th>
              <th>Inscrições Abertas</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody id="listaTorneios">
            <tr>
              <td colspan="5">Carregando torneios...</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Inscrição -->
      <section id="inscricao" class="container">
        <h2>Inscreva-se</h2>
        <form id="form-inscricao">
          <label for="nome">Nome do Jogador:</label>
          <input
            type="text"
            id="nome"
            name="nome"
            placeholder="Digite o nome completo"
            required
          />

          <label for="email">E-mail:</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Seu e-mail"
          />

          <label for="telefone">Telefone / WhatsApp:</label>
          <input
            type="tel"
            id="telefone"
            name="telefone"
            placeholder="(DDD) 99999-9999"
            required
          />

          <label for="dupla">Nome da Dupla:</label>
          <input
            type="text"
            id="dupla"
            name="dupla"
            placeholder="Digite o nome do parceiro (opcional)"
          />

          <label for="torneio">Selecione o Torneio:</label>
          <select id="torneio" name="torneio" required>
            <option value="">Selecione o Torneio</option>
          </select>

          <button type="submit" class="botao-inscricao">
            Enviar Inscrição
          </button>
        </form>

        <p id="resposta"></p>
      </section>

      <!-- Galeria -->
      <section id="galeria" class="container">
        <h2>Galeria de Fotos</h2>
        <div class="gallery">
          <img src="flyer/porto.png" alt="Foto Torneio 1" />
          <img
            src="https://via.placeholder.com/200x120?text=Torneio+2"
            alt="Foto Torneio 2"
          />
          <img
            src="https://via.placeholder.com/200x120?text=Torneio+3"
            alt="Foto Torneio 3"
          />
        </div>
      </section>
    </main>

    <a href="#inicio" class="voltar-topo">↑ Voltar ao topo</a>

    <footer>
      <p>&copy; 2025 Vôlei de Praia Amador. Todos os direitos reservados.</p>
    </footer>
  </body>
  <!-- Adicione este script no final do body -->
  <script>
    // --- Carregar tabela de torneios no site ---
    async function carregarTabelaTorneios() {
      const tabela = document.getElementById("listaTorneios");
      tabela.innerHTML = "<tr><td colspan='5'>Carregando torneios...</td></tr>";

      try {
        const resposta = await fetch("http://localhost:8800/torneios");
        const dados = await resposta.json();

        tabela.innerHTML = "";

        if (!dados.data || dados.data.length === 0) {
          tabela.innerHTML =
            "<tr><td colspan='5'>Nenhum torneio disponível no momento.</td></tr>";
          return;
        }

        dados.data.forEach((t) => {
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${t.nome}</td>
            <td>${new Date(t.data).toLocaleDateString("pt-BR")}</td>
            <td>${t.local}</td>
            <td>${t.descricao || "-"}</td>
            <td>Sim</td>
            <td>
              ${
                t.link
                  ? `<a href="${t.link}" target="_blank">Acessar Link</a>`
                  : "-"
              }
            </td>
          `;
          tabela.appendChild(linha);
        });
      } catch (error) {
        console.error("Erro ao carregar torneios:", error);
        tabela.innerHTML =
          "<tr><td colspan='5'>Erro ao carregar os torneios.</td></tr>";
      }
    }

    // --- Carregar torneios no select do formulário ---
    async function carregarSelectTorneios() {
      try {
        const resp = await fetch("http://localhost:8800/torneios");
        const dados = await resp.json();
        const select = document.getElementById("torneio");

        select.innerHTML = '<option value="">Selecione o Torneio</option>';
        dados.data.forEach((t) => {
          const option = document.createElement("option");
          option.value = t.id;
          option.textContent = t.nome;
          select.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar torneios:", error);
      }
    }

    // --- Executar as duas ao abrir a página ---
    carregarTabelaTorneios();
    carregarSelectTorneios();

    // --- Envio do formulário ---
    const form = document.getElementById("form-inscricao");
    const resposta = document.getElementById("resposta");

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const dados = {
        nome_jogador: document.getElementById("nome").value,
        email_jogador: document.getElementById("email").value,
        telefone: document.getElementById("telefone").value,
        dupla: document.getElementById("dupla").value,
        torneio_id: document.getElementById("torneio").value,
      };

      try {
        const resp = await fetch("http://localhost:8800/inscricoes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados),
        });

        const resultado = await resp.json();

        if (resp.ok) {
          resposta.textContent = "Inscrição enviada com sucesso!";
          resposta.style.color = "green";
          form.reset();
        } else {
          resposta.textContent =
            resultado.message || "Erro ao enviar inscrição.";
          resposta.style.color = "red";
        }
      } catch (error) {
        resposta.textContent = "Erro de conexão com o servidor.";
        resposta.style.color = "red";
      }
    });
  </script>
</html>
